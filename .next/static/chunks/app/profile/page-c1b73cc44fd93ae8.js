(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{6795:function(e,t,n){Promise.resolve().then(n.bind(n,9939))},9939:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n(7437),a=n(2265),i=n(4260);function o(){let[e,t]=(0,a.useState)("-"),[n,o]=(0,a.useState)("-"),[c,l]=(0,a.useState)(""),[s,d]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{(async function(){d(!0);try{let e=await fetch("/api/user/me"),n=await e.json();t(n.email||"-"),o(n.username||"-")}catch(e){l("사용자 정보를 불러오지 못했습니다."),t("-"),o("-")}d(!1)})()},[]),(0,r.jsxs)("div",{style:{maxWidth:400,margin:"60px auto",padding:32,background:"#fff",borderRadius:16,boxShadow:"0 2px 16px #e3e8f7",border:"1px solid #e3e8f7",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,r.jsx)(i.m3W,{size:96,style:{color:"#b0c7f7",border:"4px solid #2086c4",borderRadius:"50%",background:"#eaf1ff",marginBottom:18}}),s?(0,r.jsx)("div",{style:{color:"#2086c4",fontWeight:500,marginBottom:12},children:"불러오는 중..."}):c?(0,r.jsx)("div",{style:{color:"#d32f2f",fontWeight:500,marginBottom:12},children:c}):null,(0,r.jsx)("div",{style:{width:"100%",textAlign:"center",color:"#888",fontWeight:600,fontSize:15,marginBottom:2},children:"이메일"}),(0,r.jsx)("div",{style:{width:"100%",textAlign:"center",color:"#222",fontWeight:600,fontSize:18,marginBottom:10},children:e}),(0,r.jsx)("div",{style:{width:"100%",textAlign:"center",color:"#888",fontWeight:600,fontSize:15,marginBottom:2},children:"아이디"}),(0,r.jsx)("div",{style:{width:"100%",textAlign:"center",color:"#222",fontWeight:600,fontSize:18},children:n})]})}var c=n(6823),l=n(9274);function s(){let[e,t]=(0,a.useState)(""),[o,s]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),f=async()=>{if(t(""),!d){t("로그인 비밀번호를 입력하세요.");return}let e=localStorage.getItem("userId")||localStorage.getItem("email");console.log("[KeyManagement] encryptedUserId:",e);let r=e?await (0,l.vm)(e):"";console.log("[KeyManagement] decrypted userId:",r);let a=await (0,c.getDB)(),i=await a.getAllKeys(c.STORE_NAME);if(console.log("[KeyManagement] IndexedDB allKeys:",i),!r){t("userId가 없습니다. (로그인 상태 확인)");return}if(!i.includes(r)){t("IndexedDB에 해당 userId로 저장된 개인키가 없습니다.");return}console.log("[KeyManagement] IndexedDB encrypted privateKey:",await a.get(c.STORE_NAME,r));let{exportPrivateKey:o}=await Promise.resolve().then(n.bind(n,6823)),s=await o(r),u=document.createElement("a");u.href=URL.createObjectURL(new Blob([null!=s?s:""],{type:"application/json"})),u.download="privateKey-backup-".concat(r,".json"),u.click(),t("개인키 백업 파일이 다운로드되었습니다.")},y=async e=>{var t;s("");let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;if(!d){s("로그인 비밀번호를 입력하세요.");return}let r=new FileReader;r.onload=async e=>{var t;let n=null===(t=e.target)||void 0===t?void 0:t.result;try{let{userId:e}=JSON.parse(n);if(!e){s("❌ 복구 실패: 파일이 올바르지 않음");return}let t=await (0,c.getDB)(),r=await t.get(c.STORE_NAME,e),a=await (0,c.importPrivateKey)(n);r?s("✅ 개인키가 정상적으로 등록되어있습니다."):a?s("✅ 개인키 복구 완료. IndexedDB에 저장되었습니다."):s("❌ 복구 실패: 파일이 올바르지 않음")}catch(e){s("❌ 복구 실패: 파일이 올바르지 않음")}},r.readAsText(n)};return(0,r.jsxs)("div",{style:{maxWidth:400,margin:"40px auto",padding:24,border:"1px solid #eee",borderRadius:10,background:"#fafbfc"},children:[(0,r.jsx)("h2",{style:{fontSize:20,marginBottom:18},children:"\uD83D\uDD11 개인키 백업/복구"}),(0,r.jsxs)("div",{style:{marginBottom:12,color:"#555",fontSize:14},children:["내 개인키는 브라우저에 암호화되어 저장됩니다.",(0,r.jsx)("br",{}),(0,r.jsx)("b",{children:"백업:"})," 비밀번호 입력 후 백업 버튼을 누르면 파일이 다운로드됩니다.",(0,r.jsx)("br",{}),(0,r.jsx)("b",{children:"복구:"})," 비밀번호 입력 후 백업 파일을 선택하면 복구됩니다."]}),(0,r.jsx)("div",{style:{marginBottom:8},children:(0,r.jsx)("input",{type:"password",placeholder:"전자서명용 비밀번호(회원가입 시 입력)",value:d,onChange:e=>u(e.target.value),style:{width:"100%",padding:10,borderRadius:4,border:"1px solid #ddd"}})}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:8},children:[(0,r.jsx)("button",{type:"button",onClick:f,style:{padding:"10px 18px",flex:1,background:"#2086c4",color:"#fff",border:"1.5px solid #2086c4",borderRadius:8,fontWeight:600,fontSize:16,cursor:"pointer",transition:"background 0.15s"},onMouseOver:e=>e.currentTarget.style.background="#176ba0",onMouseOut:e=>e.currentTarget.style.background="#2086c4",children:"개인키 백업(내보내기)"}),(0,r.jsxs)("label",{style:{flex:1,display:"block"},children:[(0,r.jsx)("span",{style:{display:"block",marginBottom:4},children:"개인키 복구(가져오기)"}),(0,r.jsx)("input",{type:"file",accept:"application/json",onChange:y,style:{display:"block",width:"100%"}})]})]}),"✅ 개인키가 정상적으로 등록되어있습니다."===o?(0,r.jsx)("div",{style:{maxWidth:400,margin:"40px auto",padding:20,border:"1px solid #eee",borderRadius:12,background:"#fafbfc",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)("div",{style:{color:"green",fontWeight:500,fontSize:15,padding:"8px 0"},children:"✅ 개인키가 정상적으로 등록되어있습니다."})}):e&&e.includes("다운로드")?(0,r.jsx)("div",{style:{maxWidth:400,margin:"40px auto",padding:20,border:"1px solid #eee",borderRadius:12,background:"#fafbfc",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)("div",{style:{color:"green",fontWeight:500,fontSize:15,padding:"8px 0"},children:"✅ 개인키 백업 파일이 다운로드되었습니다."})}):(0,r.jsx)(r.Fragment,{children:o&&(0,r.jsxs)("div",{style:{marginTop:8,color:o.startsWith("✅")?"green":"red",display:"flex",alignItems:"center",fontWeight:600,fontSize:16},children:[o.startsWith("✅")&&(0,r.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:"50%",background:"#4caf50",marginRight:8},children:(0,r.jsx)(i.FJM,{style:{color:"#fff",fontSize:16}})}),o]})})]})}var d=n(9767),u=n.n(d);function f(){let[e,t]=(0,a.useState)("profile");return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,r.jsxs)("div",{style:{display:"flex",gap:16,marginTop:48,marginBottom:32},children:[(0,r.jsx)("button",{onClick:()=>t("profile"),className:"".concat(u()["profile-tab"]).concat("profile"===e?" "+u().selected:""),children:"프로필"}),(0,r.jsx)("button",{onClick:()=>t("key"),className:"".concat(u()["profile-tab"]).concat("key"===e?" "+u().selected:""),children:"개인키 백업/복구"})]}),(0,r.jsxs)("div",{className:"max-w-md mx-auto p-8 bg-white rounded-3xl shadow-2xl border-2 border-blue-100",children:["profile"===e&&(0,r.jsx)(o,{}),"key"===e&&(0,r.jsx)(s,{})]})]})})}},9274:function(e,t,n){"use strict";let r;n.d(t,{LJ:function(){return s},bd:function(){return o},hH:function(){return u},jz:function(){return l},oj:function(){return c},vm:function(){return f}});var a=n(2957).lW,i=n(257);async function o(e,t){let n=new TextEncoder,r=await window.crypto.subtle.importKey("raw",n.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:n.encode(t),iterations:1e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function c(e,t){var n;if(!(null===(n=window.crypto)||void 0===n?void 0:n.subtle))throw Error("이 브라우저는 WebCrypto를 지원하지 않습니다.");let r=new TextEncoder,a=window.crypto.getRandomValues(new Uint8Array(12)),i=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,r.encode(e));return{iv:btoa(String.fromCharCode(...a)),data:btoa(String.fromCharCode(...new Uint8Array(i)))}}async function l(e,t){var n;if(!(null===(n=window.crypto)||void 0===n?void 0:n.subtle))throw Error("이 브라우저는 WebCrypto를 지원하지 않습니다.");let r=new TextDecoder,a=Uint8Array.from(atob(e.iv),e=>e.charCodeAt(0)),i=Uint8Array.from(atob(e.data),e=>e.charCodeAt(0)),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a},t,i);return r.decode(o)}function s(e){if(!r)throw Error("Node.js crypto not available");let t=a.from(i.env.EMAIL_AES_KEY,"hex"),[n,o]=e.split(":"),c=a.from(n,"hex"),l=r.createDecipheriv("aes-256-cbc",t,c);return l.update(o,"hex","utf8")+l.final("utf8")}async function d(){return o("5012145a3c04312f81ce8b38c90d875f7de96b868f94f451cd6d6709a92d7c23","38f74cb399659a9016a080d65395986f")}async function u(e){let t=await d(),{iv:n,data:r}=await c(e,t);return JSON.stringify({iv:n,data:r})}async function f(e){try{console.log("[decryptLocal] 입력값:",e);let t=await d(),n=JSON.parse(e);console.log("[decryptLocal] 파싱된 iv:",n.iv),console.log("[decryptLocal] 파싱된 data:",n.data);let r=await l({iv:n.iv,data:n.data},t);return console.log("[decryptLocal] 복호화 결과:",r),r}catch(e){throw console.error("[decryptLocal] 복호화 중 에러:",e),e}}},6823:function(e,t,n){"use strict";n.r(t),n.d(t,{STORE_NAME:function(){return i},deleteAESKey:function(){return g},deletePrivateKey:function(){return d},exportPrivateKey:function(){return u},getDB:function(){return c},importPrivateKey:function(){return f},loadAESKey:function(){return p},loadPrivateKey:function(){return s},saveAESKey:function(){return y},savePrivateKey:function(){return l}});var r=n(960),a=n(9274);let i="privateKeys",o="aesKeys";async function c(){return(0,r.X3)("secure-sign-db",1,{upgrade(e){e.objectStoreNames.contains(i)||e.createObjectStore(i),e.objectStoreNames.contains(o)||e.createObjectStore(o)}})}async function l(e,t,n){console.log("[DEBUG] savePrivateKey - 저장 전 privateKey (앞 50):",t.slice(0,50)),console.log("[DEBUG] savePrivateKey - 저장 전 privateKey 길이:",t.length);let r=await (0,a.bd)(n,e),o=await (0,a.oj)(t,r);console.log("[DEBUG] savePrivateKey - 암호화된 privateKey:",JSON.stringify(o).slice(0,100));let l=await c();await l.put(i,o,e)}async function s(e,t){let n=await c(),r=await n.get(i,e);if(!r)return;let o=await (0,a.bd)(t,e),l=await (0,a.jz)(r,o);return console.log("[DEBUG] loadPrivateKey - 복호화된 privateKey (앞 50):",l.slice(0,50)),console.log("[DEBUG] loadPrivateKey - 복호화된 privateKey 길이:",l.length),l}async function d(e){let t=await c();await t.delete(i,e)}async function u(e){let t=await c(),n=await t.get(i,e);if(n)return JSON.stringify({userId:e,encryptedPrivateKey:n})}async function f(e){try{let{userId:t,encryptedPrivateKey:n}=JSON.parse(e);if(!t||!n)throw Error("Invalid backup file");let r=await c();return await r.put(i,n,t),!0}catch(e){return!1}}async function y(e,t,n,r){let a=await c();await a.put(o,{encryptedAESKey:n,iv:r},"".concat(e,":").concat(t))}async function p(e,t){return(await c()).get(o,"".concat(e,":").concat(t))}async function g(e,t){let n=await c();await n.delete(o,"".concat(e,":").concat(t))}},9767:function(e){e.exports={"profile-tab":"ProfileTab_profile-tab__50cZX",selected:"ProfileTab_selected__ezAdw"}}},function(e){e.O(0,[864,420,244,149,971,117,744],function(){return e(e.s=6795)}),_N_E=e.O()}]);