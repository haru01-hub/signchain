"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[528],{4528:function(e,t,i){i.r(t),i.d(t,{default:function(){return f}});var n=i(7437),l=i(2265),a=i(166);i(6896).GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs";let o=(0,a.default)(()=>i.e(618).then(i.bind(i,618)).then(e=>e.Document),{loadableGenerated:{webpack:()=>[3996]},ssr:!1}),r=(0,a.default)(()=>i.e(618).then(i.bind(i,618)).then(e=>e.Page),{loadableGenerated:{webpack:()=>[3996]},ssr:!1});var s=e=>{let{loading:t,error:i,pdfUrl:a,docxHtml:s,fileContent:d,width:c=650,height:u=700}=e,[f,g]=(0,l.useState)(null);return t?(0,n.jsx)("div",{children:"본문 불러오는 중..."}):i?(0,n.jsx)("div",{style:{color:"red"},children:i}):f?(0,n.jsx)("div",{style:{color:"red"},children:f}):a?(0,n.jsx)("div",{style:{width:c,height:u,overflow:"auto",background:"#f8f8f8",borderRadius:8},children:(0,n.jsx)(o,{file:a,onLoadError:e=>g("PDF 로드 실패: "+e.message),loading:"PDF 불러오는 중...",children:(0,n.jsx)(r,{pageNumber:1,width:c-32,height:void 0})})}):s?(0,n.jsx)("div",{style:{background:"#f8f8f8",padding:16,borderRadius:8,width:c,minHeight:u,maxHeight:u,overflow:"auto",fontFamily:"Noto Sans KR, Malgun Gothic, Apple SD Gothic Neo, sans-serif"},dangerouslySetInnerHTML:{__html:s}}):d?(0,n.jsx)("pre",{style:{textAlign:"left",maxHeight:u,minHeight:u,overflow:"auto",background:"#f8f8f8",padding:16,borderRadius:8,width:c,fontFamily:"Noto Sans KR, Malgun Gothic, Apple SD Gothic Neo, sans-serif"},children:d}):null},d=i(8613),c=i(4335),u=i(9376);{let{pdfjs:e}=i(3996);e.GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs"}var f=e=>{var t,i,a,o,r,f,g;let{contract:p,onClose:h,type:x="received",onTitleClick:m}=e,[v,b]=(0,l.useState)(0),[j,y]=(0,l.useState)(null),[w,S]=(0,l.useState)(null),[k,D]=(0,l.useState)(null),[C,R]=(0,l.useState)(!1),[I,W]=(0,l.useState)(""),[G,z]=(0,l.useState)(!1),[N,_]=(0,l.useState)(!1),E=(0,u.useRouter)(),H="expired"===p.status,L="rejected"===p.status,F="received"===x;p.status;let A=!H&&("sent"===x||F&&!L);return(0,l.useEffect)(()=>{!A&&(H||L&&F)&&_(!0)},[A,H,L,F]),(0,l.useEffect)(()=>{if(!A){W(H?"계약서가 만료되어 미리보기를 할 수 없습니다.":L?"계약서가 거부/반려되어 미리보기를 할 수 없습니다.":"미리보기를 할 수 없습니다."),R(!1);return}R(!0),(async()=>{try{if(p.title.endsWith(".pdf")){let e=await fetch("/api/contract/".concat(p._id,"/preview"),{cache:"no-store"});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"미리보기 파일을 불러오지 못했습니다.")}let t=await e.blob();if(0===t.size){W("PDF 미리보기 파일이 비어 있습니다."),R(!1);return}S(URL.createObjectURL(t)),y(null)}else{let e=await fetch("/api/contract/".concat(p._id,"/preview"),{cache:"no-store"});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"미리보기 파일을 불러오지 못했습니다.")}let t=await e.json();p.title.endsWith(".txt")||p.title.endsWith(".docx")?(y(t.preview),S(null)):W("미리보기를 지원하지 않는 파일 형식입니다.")}R(!1)}catch(e){W(e.message||"미리보기 파일을 불러오지 못했습니다."),R(!1)}})()},[p,v,A]),(0,n.jsxs)("div",{style:{background:"#fff",borderRadius:16,padding:40,minWidth:700,maxWidth:"90vw",boxShadow:"0 4px 32px #0002",textAlign:"center",position:"relative",fontFamily:"Noto Sans KR, Malgun Gothic, Apple SD Gothic Neo, sans-serif"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:16,maxWidth:"100%",marginBottom:24},children:[(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0,flex:1},children:(0,n.jsxs)("h2",{style:{margin:0,fontSize:28,maxWidth:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minWidth:0,cursor:"uploaded"===p.status?"pointer":"default",textDecoration:"uploaded"===p.status?"underline":"none"},title:p.title,onClick:"uploaded"===p.status&&"function"==typeof m?m:void 0,children:[(null!==(f=p.title)&&void 0!==f?f:"").length>=27?(null!==(g=p.title)&&void 0!==g?g:"").slice(0,27)+"...":p.title,p.filename&&(0,n.jsxs)("span",{style:{color:"#888",fontSize:18,marginLeft:8},children:["(",null===(t=p.filename.split(".").pop())||void 0===t?void 0:t.toUpperCase(),")"]})]})}),(0,n.jsx)("div",{style:{display:"flex",gap:8}})]}),(0,n.jsx)("div",{style:{minHeight:500,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:24},children:1===v?(null===(i=p.signature)||void 0===i?void 0:i.signatureImageDigital)||p.signatureImageDigital?(0,n.jsx)("img",{src:(null===(a=p.signature)||void 0===a?void 0:a.signatureImageDigital)||p.signatureImageDigital,alt:"서명 확인",style:{width:350,border:"1px solid #eee",borderRadius:8}}):(!p.signed||!((null===(o=p.signature)||void 0===o?void 0:o.signatureImageDigital)||p.signatureImageDigital))&&(0,n.jsx)("div",{style:{color:"#1976d2",fontSize:18},children:"received"===x?"아직 서명하지 않았습니다.":"수신자가 서명을 하지 않았습니다."}):I?(0,n.jsx)("div",{style:{color:"red",fontWeight:500,fontSize:18,margin:"32px 0"},children:I}):(0,n.jsx)(s,{loading:C,error:I,pdfUrl:w,docxHtml:k,fileContent:j,width:650,height:700})}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:32,marginBottom:24},children:[(0,n.jsx)("button",{onClick:()=>b(0),disabled:0===v,style:{fontSize:18,padding:"10px 28px",borderRadius:8,border:"1px solid #ccc",background:0===v?"#1976d2":"#fff",color:0===v?"#fff":"#333",cursor:0===v?"default":"pointer"},children:"본문 미리보기"}),(0,n.jsx)("button",{onClick:()=>b(1),disabled:1===v,style:{fontSize:18,padding:"10px 28px",borderRadius:8,border:"1px solid #ccc",background:1===v?"#1976d2":"#fff",color:1===v?"#fff":"#333",cursor:1===v?"default":"pointer"},children:"서명 확인"})]}),"received"===x&&1===v&&!p.signed&&!((null===(r=p.signature)||void 0===r?void 0:r.signatureImageDigital)||p.signatureImageDigital)&&(0,n.jsx)("div",{style:{color:"#1976d2",fontSize:16,marginBottom:12},children:"아직 서명하지 않았습니다."}),(0,n.jsx)("button",{style:{marginTop:16,fontSize:17,padding:"8px 32px",borderRadius:8},onClick:h,children:"닫기"}),G&&(0,n.jsx)(d.Z,{contract:p,onComplete:()=>{z(!1),h&&h()},onClose:()=>z(!1)}),N&&(0,n.jsx)(c.Z,{message:H?"계약서가 만료되었습니다. 만료일을 연장하시겠습니까?":L&&F?"계약서가 반려되어 더 이상 열람할 수 없습니다.":"미리보기를 할 수 없습니다.",onConfirm:()=>{_(!1),E.push("/contract")},onCancel:()=>{_(!1),E.push("/contract")},confirmLabel:"확인",cancelLabel:"닫기"})]})}}}]);