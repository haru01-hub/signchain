(()=>{var e={};e.id=8210,e.ids=[8210],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},16671:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>f,tree:()=>l}),r(78726),r(48395),r(35866);var n=r(23191),a=r(88716),o=r(37922),i=r.n(o),s=r(95231),c={};for(let e in s)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>s[e]);r.d(t,c);let l=["",{children:["otp",{children:["verify",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,78726)),"E:\\test2\\app\\otp\\verify\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,48395)),"E:\\test2\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],d=["E:\\test2\\app\\otp\\verify\\page.tsx"],u="/otp/verify/page",p={require:r,loadChunk:()=>Promise.resolve()},f=new n.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/otp/verify/page",pathname:"/otp/verify",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},19593:(e,t,r)=>{Promise.resolve().then(r.bind(r,185)),Promise.resolve().then(r.bind(r,65572)),Promise.resolve().then(r.bind(r,32779)),Promise.resolve().then(r.bind(r,9536))},53952:(e,t,r)=>{Promise.resolve().then(r.bind(r,39833))},134:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},39833:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f,dynamic:()=>d});var n=r(10326),a=r(17577),o=r(35047),i=r(16041),s=r(76865),c=r(43192);async function l(e,t){let r=await fetch(e,{...t,credentials:"include"});if(401===r.status){if((await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)r=await fetch(e,{...t,credentials:"include"});else throw Error("세션이 만료되었습니다. 다시 로그인 해주세요.")}return r}let d="force-dynamic";function u(e){return/^\d{6}$/.test(e)}function p(){let[e,t]=(0,a.useState)(""),[d,p]=(0,a.useState)(""),[f,y]=(0,a.useState)({}),[h,v]=(0,a.useState)(""),[x,w]=(0,a.useState)(!1),g=(0,o.useSearchParams)().get("mode"),m=(0,a.useRef)(null),P=(0,o.useRouter)(),b="register"===g,E=u(e)&&(!b||d.length>=6);async function S(t){if(t&&t.preventDefault(),!E){v("입력값을 다시 확인하세요.");return}v(""),w(!0);try{let t;let n=await l("/api/otp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e}),credentials:"include"});console.log("RAW response:",n);try{let e=n.headers.get("content-type");t=e&&e.includes("application/json")?await n.json():{message:await n.text()},console.log("Parsed data:",t)}catch(e){console.error("응답 파싱 실패:",e,n),v("응답 파싱 실패: "+e),w(!1);return}if(t.redirectTo){if(b)try{if(!t.userId)throw Error("userId 없음");if(!t.privateKey)throw Error("서버에서 개인키를 받지 못했습니다.");if(await (0,i.savePrivateKey)(t.userId,t.privateKey,d),localStorage.setItem("userId",await (0,c.hH)(t.userId)),t.email&&localStorage.setItem("email",await (0,c.hH)(t.email)),t.publicKey)try{let e=(await r.e(4349).then(r.t.bind(r,94349,23))).default,n=e.pki.privateKeyFromPem(t.privateKey),a=e.pki.setRsaPublicKey(n.n,n.e);e.pki.publicKeyToPem(a),t.publicKey,P.push(t.redirectTo);return}catch(e){console.error("[DEBUG] 공개키 비교 중 오류:",e),w(!1);return}w(!1);return}catch(e){v("개인키 저장 오류: "+(e instanceof Error?e.message:String(e))),w(!1);return}P.push(t.redirectTo);return}v(t.message||"OTP 인증 실패"),w(!1)}catch(e){v("인증 중 오류가 발생했습니다."),w(!1)}}return(0,n.jsxs)("div",{className:"card",children:[x&&n.jsx(s.Z,{}),n.jsx("h1",{children:"OTP 인증"}),(0,n.jsxs)("p",{style:{marginBottom:b?0:10},children:["\uD83D\uDCF1 Google Authenticator 등에서 OTP 코드를 입력하세요."," ",b&&(0,n.jsxs)("span",{style:{color:"#1a237e",fontSize:15,fontWeight:500},children:[n.jsx("b",{children:"아래 비밀번호는 전자서명 및 파일 복호화, 개인키 복구 등에 사용됩니다."}),n.jsx("br",{}),n.jsx("span",{style:{color:"#d32f2f",fontWeight:500},children:"로그인/회원가입 비밀번호와 다를 수 있으니 반드시 기억해 주세요."})]})]}),(0,n.jsxs)("form",{onSubmit:S,autoComplete:"off",children:[n.jsx("input",{ref:m,value:e,onChange:e=>{t(e.target.value),y(e=>({...e,otp:!0})),v("")},placeholder:"OTP 코드 입력 (6자리 숫자)",style:{marginTop:10,borderColor:f.otp&&!u(e)?"red":void 0}}),f.otp&&!u(e)&&n.jsx("div",{style:{color:"red",fontSize:13},children:"6자리 숫자를 입력하세요."}),b&&(0,n.jsxs)(n.Fragment,{children:[n.jsx("div",{style:{height:12}}),n.jsx("input",{type:"password",value:d,onChange:e=>{p(e.target.value),y(e=>({...e,pw:!0})),v("")},placeholder:"전자서명용 비밀번호 (6자리 이상)",style:{marginTop:0,borderColor:f.pw&&d.length<6?"red":void 0}}),f.pw&&d.length<6&&n.jsx("div",{style:{color:"red",fontSize:13},children:"6자리 이상 비밀번호를 입력하세요."})]}),n.jsx("button",{type:"submit",disabled:!E,style:{width:"100%",marginTop:12},children:"OTP 인증"})]}),h&&n.jsx("div",{style:{color:"red",marginTop:10},children:h}),"login"===g&&n.jsx(n.Fragment,{})]})}function f(){return n.jsx(a.Suspense,{children:n.jsx(p,{})})}},185:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var n=r(10326),a=r(35047),o=r(17577),i=r(76865);function s(){let e=(0,a.usePathname)(),[t,r]=(0,o.useState)(!1);return(0,o.useRef)(e),t?n.jsx(i.Z,{}):null}r(55440)},76865:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(10326);r(17577),r(55440);let a=()=>n.jsx("div",{className:"spinner-overlay",children:n.jsx("div",{className:"spinner"})})},65572:(e,t,r)=>{"use strict";r.d(t,{ContractProvider:()=>i,z:()=>s});var n=r(10326),a=r(17577);let o=(0,a.createContext)(void 0);function i({children:e}){let[t,r]=(0,a.useState)([]),[i,s]=(0,a.useState)(!0),c=(0,a.useCallback)(async()=>{s(!0);try{let e=await fetch("/api/contract",{credentials:"include"});if(!e.ok)throw Error("API error");let t=await e.json();r(t||[])}catch{r([])}finally{s(!1)}},[]);return n.jsx(o.Provider,{value:{contracts:t,loading:i,refreshContracts:c},children:e})}function s(){let e=(0,a.useContext)(o);if(!e)throw Error("useContractContext must be used within a ContractProvider");return e}},32779:(e,t,r)=>{"use strict";r.d(t,{NotificationProvider:()=>i,n:()=>s});var n=r(10326),a=r(17577);let o=(0,a.createContext)(void 0);function i({children:e}){let[t,r]=(0,a.useState)([]),[i,s]=(0,a.useState)(0),[c,l]=(0,a.useState)(!0),d=(0,a.useCallback)(async()=>{l(!0);try{let e=await fetch("/api/auth/notifications",{credentials:"include"});if(!e.ok)throw Error("API error");let t=await e.json();r(t.notifications||[]),s((t.notifications||[]).filter(e=>!e.read).length)}catch{r([]),s(0)}finally{l(!1)}},[]);return n.jsx(o.Provider,{value:{notifications:t,unreadCount:i,loading:c,refreshNotifications:d},children:e})}function s(){let e=(0,a.useContext)(o);if(!e)throw Error("useNotificationContext must be used within a NotificationProvider");return e}},9536:(e,t,r)=>{"use strict";r.d(t,{UserProvider:()=>i});var n=r(10326),a=r(17577);let o=(0,a.createContext)(void 0);function i({children:e}){let[t,r]=(0,a.useState)(null),i=async()=>{try{let e=await fetch("/api/user/me");if(!e.ok)throw Error("API error");let t=await e.json();r(t)}catch{r(null)}};return n.jsx(o.Provider,{value:{user:t,setUser:r,refreshUser:i},children:e})}},43192:(e,t,r)=>{"use strict";let n;async function a(e,t){let r=new TextEncoder,n=await window.crypto.subtle.importKey("raw",r.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:r.encode(t),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function o(e,t){if(!window.crypto?.subtle)throw Error("이 브라우저는 WebCrypto를 지원하지 않습니다.");let r=new TextEncoder,n=window.crypto.getRandomValues(new Uint8Array(12)),a=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,r.encode(e));return{iv:btoa(String.fromCharCode(...n)),data:btoa(String.fromCharCode(...new Uint8Array(a)))}}async function i(e,t){if(!window.crypto?.subtle)throw Error("이 브라우저는 WebCrypto를 지원하지 않습니다.");let r=new TextDecoder,n=Uint8Array.from(atob(e.iv),e=>e.charCodeAt(0)),a=Uint8Array.from(atob(e.data),e=>e.charCodeAt(0)),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,a);return r.decode(o)}function s(e){if(!n)throw Error("Node.js crypto not available");let t=Buffer.from(process.env.EMAIL_AES_KEY,"hex"),[r,a]=e.split(":"),o=Buffer.from(r,"hex"),i=n.createDecipheriv("aes-256-cbc",t,o);return i.update(a,"hex","utf8")+i.final("utf8")}async function c(){return a("5012145a3c04312f81ce8b38c90d875f7de96b868f94f451cd6d6709a92d7c23","38f74cb399659a9016a080d65395986f")}async function l(e){let t=await c(),{iv:r,data:n}=await o(e,t);return JSON.stringify({iv:r,data:n})}async function d(e){try{console.log("[decryptLocal] 입력값:",e);let t=await c(),r=JSON.parse(e);console.log("[decryptLocal] 파싱된 iv:",r.iv),console.log("[decryptLocal] 파싱된 data:",r.data);let n=await i({iv:r.iv,data:r.data},t);return console.log("[decryptLocal] 복호화 결과:",n),n}catch(e){throw console.error("[decryptLocal] 복호화 중 에러:",e),e}}r.d(t,{LJ:()=>s,bd:()=>a,hH:()=>l,jz:()=>i,oj:()=>o,vm:()=>d}),n=r(84770)},16041:(e,t,r)=>{"use strict";r.r(t),r.d(t,{STORE_NAME:()=>o,deleteAESKey:()=>h,deletePrivateKey:()=>d,exportPrivateKey:()=>u,getDB:()=>s,importPrivateKey:()=>p,loadAESKey:()=>y,loadPrivateKey:()=>l,saveAESKey:()=>f,savePrivateKey:()=>c});var n=r(84679),a=r(43192);let o="privateKeys",i="aesKeys";async function s(){return(0,n.X3)("secure-sign-db",1,{upgrade(e){e.objectStoreNames.contains(o)||e.createObjectStore(o),e.objectStoreNames.contains(i)||e.createObjectStore(i)}})}async function c(e,t,r){console.log("[DEBUG] savePrivateKey - 저장 전 privateKey (앞 50):",t.slice(0,50)),console.log("[DEBUG] savePrivateKey - 저장 전 privateKey 길이:",t.length);let n=await (0,a.bd)(r,e),i=await (0,a.oj)(t,n);console.log("[DEBUG] savePrivateKey - 암호화된 privateKey:",JSON.stringify(i).slice(0,100));let c=await s();await c.put(o,i,e)}async function l(e,t){let r=await s(),n=await r.get(o,e);if(!n)return;let i=await (0,a.bd)(t,e),c=await (0,a.jz)(n,i);return console.log("[DEBUG] loadPrivateKey - 복호화된 privateKey (앞 50):",c.slice(0,50)),console.log("[DEBUG] loadPrivateKey - 복호화된 privateKey 길이:",c.length),c}async function d(e){let t=await s();await t.delete(o,e)}async function u(e){let t=await s(),r=await t.get(o,e);if(r)return JSON.stringify({userId:e,encryptedPrivateKey:r})}async function p(e){try{let{userId:t,encryptedPrivateKey:r}=JSON.parse(e);if(!t||!r)throw Error("Invalid backup file");let n=await s();return await n.put(o,r,t),!0}catch{return!1}}async function f(e,t,r,n){let a=await s();await a.put(i,{encryptedAESKey:r,iv:n},`${e}:${t}`)}async function y(e,t){return(await s()).get(i,`${e}:${t}`)}async function h(e,t){let r=await s();await r.delete(i,`${e}:${t}`)}},48395:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u,dynamic:()=>l,metadata:()=>d});var n=r(19510);r(67272);var a=r(68570);let o=(0,a.createProxy)(String.raw`E:\test2\contexts\NotificationContext.tsx#NotificationProvider`);(0,a.createProxy)(String.raw`E:\test2\contexts\NotificationContext.tsx#useNotificationContext`);let i=(0,a.createProxy)(String.raw`E:\test2\contexts\ContractContext.tsx#ContractProvider`);(0,a.createProxy)(String.raw`E:\test2\contexts\ContractContext.tsx#useContractContext`);let s=(0,a.createProxy)(String.raw`E:\test2\components\GlobalLoading.tsx#default`),c=(0,a.createProxy)(String.raw`E:\test2\contexts\UserContext.tsx#UserProvider`);(0,a.createProxy)(String.raw`E:\test2\contexts\UserContext.tsx#useUserContext`);let l="force-dynamic",d={title:"SignChain",description:"전자서명/계약 서비스"};function u({children:e}){return n.jsx("html",{lang:"en",children:n.jsx("body",{className:"antialiased",children:n.jsx(c,{children:n.jsx(o,{children:(0,n.jsxs)(i,{children:[n.jsx(s,{}),e]})})})})})}},78726:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o,dynamic:()=>a});var n=r(68570);let a=(0,n.createProxy)(String.raw`E:\test2\app\otp\verify\page.tsx#dynamic`),o=(0,n.createProxy)(String.raw`E:\test2\app\otp\verify\page.tsx#default`)},67272:()=>{},55440:()=>{},84679:(e,t,r)=>{"use strict";let n,a,o,i;r.d(t,{X3:()=>y});let s=(e,t)=>t.some(t=>e instanceof t),c=new WeakMap,l=new WeakMap,d=new WeakMap,u={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return c.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return p(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function p(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{t(p(e.result)),n()},o=()=>{r(e.error),n()};e.addEventListener("success",a),e.addEventListener("error",o)});return d.set(t,e),t}(e);if(l.has(e))return l.get(e);let r="function"==typeof(t=e)?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(f(this),e),p(this.request)}:function(...e){return p(t.apply(f(this),e))}:(t instanceof IDBTransaction&&function(e){if(c.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{t(),n()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});c.set(e,t)}(t),s(t,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,u):t;return r!==e&&(l.set(e,r),d.set(r,e)),r}let f=e=>d.get(e);function y(e,t,{blocked:r,upgrade:n,blocking:a,terminated:o}={}){let i=indexedDB.open(e,t),s=p(i);return n&&i.addEventListener("upgradeneeded",e=>{n(p(i.result),e.oldVersion,e.newVersion,p(i.transaction),e)}),r&&i.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),a&&e.addEventListener("versionchange",e=>a(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}let h=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],x=new Map;function w(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(x.get(t))return x.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,a=v.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(a||h.includes(r)))return;let o=async function(e,...t){let o=this.transaction(e,a?"readwrite":"readonly"),i=o.store;return n&&(i=i.index(t.shift())),(await Promise.all([i[r](...t),a&&o.done]))[0]};return x.set(t,o),o}u={...o=u,get:(e,t,r)=>w(e,t)||o.get(e,t,r),has:(e,t)=>!!w(e,t)||o.has(e,t)};let g=["continue","continuePrimaryKey","advance"],m={},P=new WeakMap,b=new WeakMap,E={get(e,t){if(!g.includes(t))return e[t];let r=m[t];return r||(r=m[t]=function(...e){P.set(this,b.get(this)[t](...e))}),r}};async function*S(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let r=new Proxy(t,E);for(b.set(r,t),d.set(r,f(t));t;)yield r,t=await (P.get(r)||t.continue()),P.delete(r)}function j(e,t){return t===Symbol.asyncIterator&&s(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&s(e,[IDBIndex,IDBObjectStore])}u={...i=u,get:(e,t,r)=>j(e,t)?S:i.get(e,t,r),has:(e,t)=>j(e,t)||i.has(e,t)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,2772],()=>r(16671));module.exports=n})();