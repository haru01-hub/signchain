(()=>{var e={};e.id=4178,e.ids=[4178],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},82581:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>f,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),r(44591),r(48395),r(35866);var n=r(23191),i=r(88716),o=r(37922),a=r.n(o),s=r(95231),l={};for(let e in s)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>s[e]);r.d(t,l);let c=["",{children:["profile",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,44591)),"E:\\test2\\app\\profile\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,48395)),"E:\\test2\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],d=["E:\\test2\\app\\profile\\page.tsx"],u="/profile/page",f={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/profile/page",pathname:"/profile",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},19593:(e,t,r)=>{Promise.resolve().then(r.bind(r,185)),Promise.resolve().then(r.bind(r,65572)),Promise.resolve().then(r.bind(r,32779)),Promise.resolve().then(r.bind(r,9536))},99678:(e,t,r)=>{Promise.resolve().then(r.bind(r,25812))},134:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},25812:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(10326),i=r(17577),o=r(94767);function a(){let[e,t]=(0,i.useState)("-"),[r,a]=(0,i.useState)("-"),[s,l]=(0,i.useState)(""),[c,d]=(0,i.useState)(!1);return(0,n.jsxs)("div",{style:{maxWidth:400,margin:"60px auto",padding:32,background:"#fff",borderRadius:16,boxShadow:"0 2px 16px #e3e8f7",border:"1px solid #e3e8f7",display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx(o.m3W,{size:96,style:{color:"#b0c7f7",border:"4px solid #2086c4",borderRadius:"50%",background:"#eaf1ff",marginBottom:18}}),c?n.jsx("div",{style:{color:"#2086c4",fontWeight:500,marginBottom:12},children:"불러오는 중..."}):s?n.jsx("div",{style:{color:"#d32f2f",fontWeight:500,marginBottom:12},children:s}):null,n.jsx("div",{style:{width:"100%",textAlign:"center",color:"#888",fontWeight:600,fontSize:15,marginBottom:2},children:"이메일"}),n.jsx("div",{style:{width:"100%",textAlign:"center",color:"#222",fontWeight:600,fontSize:18,marginBottom:10},children:e}),n.jsx("div",{style:{width:"100%",textAlign:"center",color:"#888",fontWeight:600,fontSize:15,marginBottom:2},children:"아이디"}),n.jsx("div",{style:{width:"100%",textAlign:"center",color:"#222",fontWeight:600,fontSize:18},children:r})]})}var s=r(16041),l=r(43192);function c(){let[e,t]=(0,i.useState)(""),[a,c]=(0,i.useState)(""),[d,u]=(0,i.useState)(""),f=async()=>{if(t(""),!d){t("로그인 비밀번호를 입력하세요.");return}let e=localStorage.getItem("userId")||localStorage.getItem("email");console.log("[KeyManagement] encryptedUserId:",e);let n=e?await (0,l.vm)(e):"";console.log("[KeyManagement] decrypted userId:",n);let i=await (0,s.getDB)(),o=await i.getAllKeys(s.STORE_NAME);if(console.log("[KeyManagement] IndexedDB allKeys:",o),!n){t("userId가 없습니다. (로그인 상태 확인)");return}if(!o.includes(n)){t("IndexedDB에 해당 userId로 저장된 개인키가 없습니다.");return}console.log("[KeyManagement] IndexedDB encrypted privateKey:",await i.get(s.STORE_NAME,n));let{exportPrivateKey:a}=await Promise.resolve().then(r.bind(r,16041)),c=await a(n),u=document.createElement("a");u.href=URL.createObjectURL(new Blob([c??""],{type:"application/json"})),u.download=`privateKey-backup-${n}.json`,u.click(),t("개인키 백업 파일이 다운로드되었습니다.")},p=async e=>{c("");let t=e.target.files?.[0];if(!t)return;if(!d){c("로그인 비밀번호를 입력하세요.");return}let r=new FileReader;r.onload=async e=>{let t=e.target?.result;try{let{userId:e}=JSON.parse(t);if(!e){c("❌ 복구 실패: 파일이 올바르지 않음");return}let r=await (0,s.getDB)(),n=await r.get(s.STORE_NAME,e),i=await (0,s.importPrivateKey)(t);n?c("✅ 개인키가 정상적으로 등록되어있습니다."):i?c("✅ 개인키 복구 완료. IndexedDB에 저장되었습니다."):c("❌ 복구 실패: 파일이 올바르지 않음")}catch(e){c("❌ 복구 실패: 파일이 올바르지 않음")}},r.readAsText(t)};return(0,n.jsxs)("div",{style:{maxWidth:400,margin:"40px auto",padding:24,border:"1px solid #eee",borderRadius:10,background:"#fafbfc"},children:[n.jsx("h2",{style:{fontSize:20,marginBottom:18},children:"\uD83D\uDD11 개인키 백업/복구"}),(0,n.jsxs)("div",{style:{marginBottom:12,color:"#555",fontSize:14},children:["내 개인키는 브라우저에 암호화되어 저장됩니다.",n.jsx("br",{}),n.jsx("b",{children:"백업:"})," 비밀번호 입력 후 백업 버튼을 누르면 파일이 다운로드됩니다.",n.jsx("br",{}),n.jsx("b",{children:"복구:"})," 비밀번호 입력 후 백업 파일을 선택하면 복구됩니다."]}),n.jsx("div",{style:{marginBottom:8},children:n.jsx("input",{type:"password",placeholder:"전자서명용 비밀번호(회원가입 시 입력)",value:d,onChange:e=>u(e.target.value),style:{width:"100%",padding:10,borderRadius:4,border:"1px solid #ddd"}})}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:8},children:[n.jsx("button",{type:"button",onClick:f,style:{padding:"10px 18px",flex:1,background:"#2086c4",color:"#fff",border:"1.5px solid #2086c4",borderRadius:8,fontWeight:600,fontSize:16,cursor:"pointer",transition:"background 0.15s"},onMouseOver:e=>e.currentTarget.style.background="#176ba0",onMouseOut:e=>e.currentTarget.style.background="#2086c4",children:"개인키 백업(내보내기)"}),(0,n.jsxs)("label",{style:{flex:1,display:"block"},children:[n.jsx("span",{style:{display:"block",marginBottom:4},children:"개인키 복구(가져오기)"}),n.jsx("input",{type:"file",accept:"application/json",onChange:p,style:{display:"block",width:"100%"}})]})]}),"✅ 개인키가 정상적으로 등록되어있습니다."===a?n.jsx("div",{style:{maxWidth:400,margin:"40px auto",padding:20,border:"1px solid #eee",borderRadius:12,background:"#fafbfc",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:n.jsx("div",{style:{color:"green",fontWeight:500,fontSize:15,padding:"8px 0"},children:"✅ 개인키가 정상적으로 등록되어있습니다."})}):e&&e.includes("다운로드")?n.jsx("div",{style:{maxWidth:400,margin:"40px auto",padding:20,border:"1px solid #eee",borderRadius:12,background:"#fafbfc",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:n.jsx("div",{style:{color:"green",fontWeight:500,fontSize:15,padding:"8px 0"},children:"✅ 개인키 백업 파일이 다운로드되었습니다."})}):n.jsx(n.Fragment,{children:a&&(0,n.jsxs)("div",{style:{marginTop:8,color:a.startsWith("✅")?"green":"red",display:"flex",alignItems:"center",fontWeight:600,fontSize:16},children:[a.startsWith("✅")&&n.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:"50%",background:"#4caf50",marginRight:8},children:n.jsx(o.FJM,{style:{color:"#fff",fontSize:16}})}),a]})})]})}var d=r(21307),u=r.n(d);function f(){let[e,t]=(0,i.useState)("profile");return n.jsx("div",{className:"min-h-screen bg-gray-50",children:(0,n.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,n.jsxs)("div",{style:{display:"flex",gap:16,marginTop:48,marginBottom:32},children:[n.jsx("button",{onClick:()=>t("profile"),className:`${u()["profile-tab"]}${"profile"===e?" "+u().selected:""}`,children:"프로필"}),n.jsx("button",{onClick:()=>t("key"),className:`${u()["profile-tab"]}${"key"===e?" "+u().selected:""}`,children:"개인키 백업/복구"})]}),(0,n.jsxs)("div",{className:"max-w-md mx-auto p-8 bg-white rounded-3xl shadow-2xl border-2 border-blue-100",children:["profile"===e&&n.jsx(a,{}),"key"===e&&n.jsx(c,{})]})]})})}},185:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var n=r(10326),i=r(35047),o=r(17577),a=r(76865);function s(){let e=(0,i.usePathname)(),[t,r]=(0,o.useState)(!1);return(0,o.useRef)(e),t?n.jsx(a.Z,{}):null}r(55440)},76865:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(10326);r(17577),r(55440);let i=()=>n.jsx("div",{className:"spinner-overlay",children:n.jsx("div",{className:"spinner"})})},65572:(e,t,r)=>{"use strict";r.d(t,{ContractProvider:()=>a,z:()=>s});var n=r(10326),i=r(17577);let o=(0,i.createContext)(void 0);function a({children:e}){let[t,r]=(0,i.useState)([]),[a,s]=(0,i.useState)(!0),l=(0,i.useCallback)(async()=>{s(!0);try{let e=await fetch("/api/contract",{credentials:"include"});if(!e.ok)throw Error("API error");let t=await e.json();r(t||[])}catch{r([])}finally{s(!1)}},[]);return n.jsx(o.Provider,{value:{contracts:t,loading:a,refreshContracts:l},children:e})}function s(){let e=(0,i.useContext)(o);if(!e)throw Error("useContractContext must be used within a ContractProvider");return e}},32779:(e,t,r)=>{"use strict";r.d(t,{NotificationProvider:()=>a,n:()=>s});var n=r(10326),i=r(17577);let o=(0,i.createContext)(void 0);function a({children:e}){let[t,r]=(0,i.useState)([]),[a,s]=(0,i.useState)(0),[l,c]=(0,i.useState)(!0),d=(0,i.useCallback)(async()=>{c(!0);try{let e=await fetch("/api/auth/notifications",{credentials:"include"});if(!e.ok)throw Error("API error");let t=await e.json();r(t.notifications||[]),s((t.notifications||[]).filter(e=>!e.read).length)}catch{r([]),s(0)}finally{c(!1)}},[]);return n.jsx(o.Provider,{value:{notifications:t,unreadCount:a,loading:l,refreshNotifications:d},children:e})}function s(){let e=(0,i.useContext)(o);if(!e)throw Error("useNotificationContext must be used within a NotificationProvider");return e}},9536:(e,t,r)=>{"use strict";r.d(t,{UserProvider:()=>a});var n=r(10326),i=r(17577);let o=(0,i.createContext)(void 0);function a({children:e}){let[t,r]=(0,i.useState)(null),a=async()=>{try{let e=await fetch("/api/user/me");if(!e.ok)throw Error("API error");let t=await e.json();r(t)}catch{r(null)}};return n.jsx(o.Provider,{value:{user:t,setUser:r,refreshUser:a},children:e})}},43192:(e,t,r)=>{"use strict";let n;async function i(e,t){let r=new TextEncoder,n=await window.crypto.subtle.importKey("raw",r.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:r.encode(t),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function o(e,t){if(!window.crypto?.subtle)throw Error("이 브라우저는 WebCrypto를 지원하지 않습니다.");let r=new TextEncoder,n=window.crypto.getRandomValues(new Uint8Array(12)),i=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,r.encode(e));return{iv:btoa(String.fromCharCode(...n)),data:btoa(String.fromCharCode(...new Uint8Array(i)))}}async function a(e,t){if(!window.crypto?.subtle)throw Error("이 브라우저는 WebCrypto를 지원하지 않습니다.");let r=new TextDecoder,n=Uint8Array.from(atob(e.iv),e=>e.charCodeAt(0)),i=Uint8Array.from(atob(e.data),e=>e.charCodeAt(0)),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,i);return r.decode(o)}function s(e){if(!n)throw Error("Node.js crypto not available");let t=Buffer.from(process.env.EMAIL_AES_KEY,"hex"),[r,i]=e.split(":"),o=Buffer.from(r,"hex"),a=n.createDecipheriv("aes-256-cbc",t,o);return a.update(i,"hex","utf8")+a.final("utf8")}async function l(){return i("5012145a3c04312f81ce8b38c90d875f7de96b868f94f451cd6d6709a92d7c23","38f74cb399659a9016a080d65395986f")}async function c(e){let t=await l(),{iv:r,data:n}=await o(e,t);return JSON.stringify({iv:r,data:n})}async function d(e){try{console.log("[decryptLocal] 입력값:",e);let t=await l(),r=JSON.parse(e);console.log("[decryptLocal] 파싱된 iv:",r.iv),console.log("[decryptLocal] 파싱된 data:",r.data);let n=await a({iv:r.iv,data:r.data},t);return console.log("[decryptLocal] 복호화 결과:",n),n}catch(e){throw console.error("[decryptLocal] 복호화 중 에러:",e),e}}r.d(t,{LJ:()=>s,bd:()=>i,hH:()=>c,jz:()=>a,oj:()=>o,vm:()=>d}),n=r(84770)},16041:(e,t,r)=>{"use strict";r.r(t),r.d(t,{STORE_NAME:()=>o,deleteAESKey:()=>x,deletePrivateKey:()=>d,exportPrivateKey:()=>u,getDB:()=>s,importPrivateKey:()=>f,loadAESKey:()=>y,loadPrivateKey:()=>c,saveAESKey:()=>p,savePrivateKey:()=>l});var n=r(84679),i=r(43192);let o="privateKeys",a="aesKeys";async function s(){return(0,n.X3)("secure-sign-db",1,{upgrade(e){e.objectStoreNames.contains(o)||e.createObjectStore(o),e.objectStoreNames.contains(a)||e.createObjectStore(a)}})}async function l(e,t,r){console.log("[DEBUG] savePrivateKey - 저장 전 privateKey (앞 50):",t.slice(0,50)),console.log("[DEBUG] savePrivateKey - 저장 전 privateKey 길이:",t.length);let n=await (0,i.bd)(r,e),a=await (0,i.oj)(t,n);console.log("[DEBUG] savePrivateKey - 암호화된 privateKey:",JSON.stringify(a).slice(0,100));let l=await s();await l.put(o,a,e)}async function c(e,t){let r=await s(),n=await r.get(o,e);if(!n)return;let a=await (0,i.bd)(t,e),l=await (0,i.jz)(n,a);return console.log("[DEBUG] loadPrivateKey - 복호화된 privateKey (앞 50):",l.slice(0,50)),console.log("[DEBUG] loadPrivateKey - 복호화된 privateKey 길이:",l.length),l}async function d(e){let t=await s();await t.delete(o,e)}async function u(e){let t=await s(),r=await t.get(o,e);if(r)return JSON.stringify({userId:e,encryptedPrivateKey:r})}async function f(e){try{let{userId:t,encryptedPrivateKey:r}=JSON.parse(e);if(!t||!r)throw Error("Invalid backup file");let n=await s();return await n.put(o,r,t),!0}catch{return!1}}async function p(e,t,r,n){let i=await s();await i.put(a,{encryptedAESKey:r,iv:n},`${e}:${t}`)}async function y(e,t){return(await s()).get(a,`${e}:${t}`)}async function x(e,t){let r=await s();await r.delete(a,`${e}:${t}`)}},21307:e=>{e.exports={"profile-tab":"ProfileTab_profile-tab__50cZX",selected:"ProfileTab_selected__ezAdw"}},48395:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u,dynamic:()=>c,metadata:()=>d});var n=r(19510);r(67272);var i=r(68570);let o=(0,i.createProxy)(String.raw`E:\test2\contexts\NotificationContext.tsx#NotificationProvider`);(0,i.createProxy)(String.raw`E:\test2\contexts\NotificationContext.tsx#useNotificationContext`);let a=(0,i.createProxy)(String.raw`E:\test2\contexts\ContractContext.tsx#ContractProvider`);(0,i.createProxy)(String.raw`E:\test2\contexts\ContractContext.tsx#useContractContext`);let s=(0,i.createProxy)(String.raw`E:\test2\components\GlobalLoading.tsx#default`),l=(0,i.createProxy)(String.raw`E:\test2\contexts\UserContext.tsx#UserProvider`);(0,i.createProxy)(String.raw`E:\test2\contexts\UserContext.tsx#useUserContext`);let c="force-dynamic",d={title:"SignChain",description:"전자서명/계약 서비스"};function u({children:e}){return n.jsx("html",{lang:"en",children:n.jsx("body",{className:"antialiased",children:n.jsx(l,{children:n.jsx(o,{children:(0,n.jsxs)(a,{children:[n.jsx(s,{}),e]})})})})})}},44591:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});let n=(0,r(68570).createProxy)(String.raw`E:\test2\app\profile\page.tsx#default`)},67272:()=>{},55440:()=>{},84679:(e,t,r)=>{"use strict";let n,i,o,a;r.d(t,{X3:()=>y});let s=(e,t)=>t.some(t=>e instanceof t),l=new WeakMap,c=new WeakMap,d=new WeakMap,u={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return f(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(f(e.result)),n()},o=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",o)});return d.set(t,e),t}(e);if(c.has(e))return c.get(e);let r="function"==typeof(t=e)?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),f(this.request)}:function(...e){return f(t.apply(p(this),e))}:(t instanceof IDBTransaction&&function(e){if(l.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),n()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});l.set(e,t)}(t),s(t,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,u):t;return r!==e&&(c.set(e,r),d.set(r,e)),r}let p=e=>d.get(e);function y(e,t,{blocked:r,upgrade:n,blocking:i,terminated:o}={}){let a=indexedDB.open(e,t),s=f(a);return n&&a.addEventListener("upgradeneeded",e=>{n(f(a.result),e.oldVersion,e.newVersion,f(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}let x=["get","getKey","getAll","getAllKeys","count"],g=["put","add","delete","clear"],h=new Map;function m(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(h.get(t))return h.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=g.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||x.includes(r)))return;let o=async function(e,...t){let o=this.transaction(e,i?"readwrite":"readonly"),a=o.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&o.done]))[0]};return h.set(t,o),o}u={...o=u,get:(e,t,r)=>m(e,t)||o.get(e,t,r),has:(e,t)=>!!m(e,t)||o.has(e,t)};let v=["continue","continuePrimaryKey","advance"],b={},w=new WeakMap,j=new WeakMap,P={get(e,t){if(!v.includes(t))return e[t];let r=b[t];return r||(r=b[t]=function(...e){w.set(this,j.get(this)[t](...e))}),r}};async function*S(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let r=new Proxy(t,P);for(j.set(r,t),d.set(r,p(t));t;)yield r,t=await (w.get(r)||t.continue()),w.delete(r)}function E(e,t){return t===Symbol.asyncIterator&&s(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&s(e,[IDBIndex,IDBObjectStore])}u={...a=u,get:(e,t,r)=>E(e,t)?S:a.get(e,t,r),has:(e,t)=>E(e,t)||a.has(e,t)}}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,2772,4767],()=>r(82581));module.exports=n})();