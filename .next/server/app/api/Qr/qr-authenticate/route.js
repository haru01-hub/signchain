"use strict";(()=>{var e={};e.id=2844,e.ids=[2844],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},95732:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{OPTIONS:()=>d,POST:()=>l});var n=r(49303),s=r(88716),a=r(60670),i=r(87070),u=r(45256),p=r(71732),c=r(10429);async function l(e){await (0,u.X)();try{let{email:t,otp:r}=await e.json(),o=await p.Z.findOne({email:t});if(!o||!o.otpSecret)return i.NextResponse.json({message:"User not found or OTP not set"},{status:404});if(!c.totp.verify({secret:o.otpSecret,encoding:"base32",token:r}))return i.NextResponse.json({message:"OTP verification failed"},{status:400});return i.NextResponse.json({message:"QR code authentication successful"})}catch(e){return console.error("QR 코드 인증 오류:",e),i.NextResponse.json({message:"Server error"},{status:500})}}async function d(){return i.NextResponse.json({},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let g=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/Qr/qr-authenticate/route",pathname:"/api/Qr/qr-authenticate",filename:"route",bundlePath:"app/api/Qr/qr-authenticate/route"},resolvedPagePath:"E:\\test2\\app\\api\\Qr\\qr-authenticate\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=g,y="/api/Qr/qr-authenticate/route";function S(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},45256:(e,t,r)=>{let o;r.d(t,{X:()=>i});var n=r(11185),s=r.n(n);let a=process.env.MONGODB_URI;if(!a)throw Error("MongoDB URI가 .env에 설정되어 있지 않습니다.");async function i(){o.conn&&o.conn.readyState>=1||(o.promise||(o.promise=s().connect(a).then(e=>e.connection)),o.conn=await o.promise)}global.mongoose?o=global.mongoose:(o={conn:null,promise:null},global.mongoose=o)},71732:(e,t,r)=>{r.d(t,{Z:()=>a});var o=r(11185),n=r.n(o);let s=new o.Schema({username:{type:String,required:!0,unique:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!0},publicKey:{type:String},certificate:{type:String},otpEnabled:{type:Boolean,default:!1},otpSecret:{type:String},otpVerified:{type:Boolean,default:!1},certificateStatus:{type:String,default:"valid"},currentRefreshJti:{type:String}}),a=n().models.User||n().model("User",s)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972,429],()=>r(95732));module.exports=o})();