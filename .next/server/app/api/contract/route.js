"use strict";(()=>{var e={};e.id=6221,e.ids=[6221],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},73073:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>E,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>S});var n={};r.r(n),r.d(n,{GET:()=>y,OPTIONS:()=>f});var o=r(49303),i=r(88716),a=r(60670),s=r(87070),u=r(45256),p=r(20975),c=r(41482),d=r.n(c),l=r(58543);async function g(e){let t=e.cookies.get("token")?.value;if(!t||!process.env.JWT_SECRET)return null;try{return d().verify(t,process.env.JWT_SECRET)}catch{return null}}async function y(e){await (0,u.X)();let t=await g(e);if(!t)return s.NextResponse.json({message:"인증이 필요합니다."},{status:401});let r="";if("object"==typeof t&&null!==t&&"id"in t?r=t.id:"object"==typeof t&&null!==t&&"_id"in t&&(r=t._id),!r)return s.NextResponse.json({message:"Unauthorized"},{status:401});try{let e=(await p.Z.find({$or:[{uploaderId:r},{recipientId:r,received:!0}],deletedBy:{$ne:r}}).sort({createdAt:-1})).map(e=>{let t=e.senderEmail,r=e.recipientEmail;try{"string"==typeof t&&t.includes(":")&&(t=(0,l.LJ)(t))}catch{t=""}try{"string"==typeof r&&r.includes(":")&&(r=(0,l.LJ)(r))}catch{r=""}return{...e.toObject(),senderEmail:t,recipientEmail:r}});return s.NextResponse.json(e)}catch(e){return console.error("API /contract error:",e),s.NextResponse.json({message:"서버 오류",error:String(e)},{status:500})}}async function f(){return s.NextResponse.json({},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let m=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/contract/route",pathname:"/api/contract",filename:"route",bundlePath:"app/api/contract/route"},resolvedPagePath:"E:\\test2\\app\\api\\contract\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:S,serverHooks:x}=m,v="/api/contract/route";function E(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:S})}},23634:(e,t,r)=>{var n;r.d(t,{r:()=>n}),function(e){e.Uploaded="uploaded",e.Signed="signed",e.Expired="expired",e.Rejected="rejected"}(n||(n={}))},45256:(e,t,r)=>{let n;r.d(t,{X:()=>s});var o=r(11185),i=r.n(o);let a=process.env.MONGODB_URI;if(!a)throw Error("MongoDB URI가 .env에 설정되어 있지 않습니다.");async function s(){n.conn&&n.conn.readyState>=1||(n.promise||(n.promise=i().connect(a).then(e=>e.connection)),n.conn=await n.promise)}global.mongoose?n=global.mongoose:(n={conn:null,promise:null},global.mongoose=n)},20975:(e,t,r)=>{r.d(t,{Z:()=>p});var n=r(11185),o=r.n(n),i=r(23634);let a=new n.Schema({signed:{type:Boolean,default:!1},signer:{type:String},certificate:{type:String},signatureImageHash:{type:String},signatureImageDigital:{type:String},signature:{type:String},signatureImageHashSignature:{type:String},qrCode:{type:String}},{_id:!1}),s=new n.Schema({fileHash:{type:String,required:!0},encryptedAesKeyForUploader:{type:String,required:!0},encryptedAesKeyForRecipient:{type:String,required:!0}},{_id:!1}),u=new n.Schema({title:{type:String,required:!0},uploaderId:{type:String,required:!0},recipientId:{type:String,required:!0},senderEmail:{type:String},recipientEmail:{type:String},filePath:{type:String,required:!0},status:{type:String,required:!0,default:i.r.Uploaded,enum:Object.values(i.r)},expirationDate:{type:Date,required:!0},received:{type:Boolean,default:!1},deletedBy:{type:[String],default:[]},security:{type:s,required:!0},signature:{type:a,default:void 0}},{timestamps:!0}),p=o().models.Contract||o().model("Contract",u)},58543:(e,t,r)=>{let n;r.d(t,{LJ:()=>a,UN:()=>i}),n=r(84770);let o="aes-256-cbc";function i(e){if(!n)throw Error("Node.js crypto not available");let t=Buffer.from(process.env.EMAIL_AES_KEY,"hex"),r=n.randomBytes(16),i=n.createCipheriv(o,t,r),a=i.update(e,"utf8","hex");return a+=i.final("hex"),r.toString("hex")+":"+a}function a(e){if(!n)throw Error("Node.js crypto not available");let t=Buffer.from(process.env.EMAIL_AES_KEY,"hex"),[r,i]=e.split(":"),a=Buffer.from(r,"hex"),s=n.createDecipheriv(o,t,a);return s.update(i,"hex","utf8")+s.final("utf8")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972,1482],()=>r(73073));module.exports=n})();