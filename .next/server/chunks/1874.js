exports.id=1874,exports.ids=[1874],exports.modules={19593:(e,t,r)=>{Promise.resolve().then(r.bind(r,185)),Promise.resolve().then(r.bind(r,65572)),Promise.resolve().then(r.bind(r,32779)),Promise.resolve().then(r.bind(r,9536))},134:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},35303:()=>{},64891:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var o=r(10326),a=r(17577),n=r(42888),i=r(16041),s=r(94349),c=r.n(s),l=r(43192);let d=({contractId:e,contractHash:t,onSigned:r,canSign:s=!0})=>{let d=(0,a.useRef)(null),[u,f]=(0,a.useState)(""),[y,p]=(0,a.useState)(""),[x,h]=(0,a.useState)(""),g=async()=>{let o=await fetch(`/api/contract/${e}`),a=await o.json();if(new Date(a.expirationDate)<new Date){console.log("계약서 만료:",a.expirationDate),p("계약서가 만료되었습니다. 서명할 수 없습니다.");return}if(!u){p("서명자 이름을 입력하세요.");return}if(!x){p("손글씨 서명을 입력하세요.");return}let n=localStorage.getItem("userId")||"",s=n?await (0,l.vm)(n):"",y=prompt("비밀번호를 입력하세요")||"",g=await (0,i.loadPrivateKey)(s,y);if(console.log("서명에 사용할 개인키:",g),!g){p("개인키를 찾을 수 없습니다.");return}let v=c().pki.privateKeyFromPem(g),w=c().md.sha256.create();w.update(t,"utf8");let m=c().util.encode64(v.sign(w)),b=c().md.sha256.create();b.update(x,"utf8");let S=c().util.encode64(v.sign(b));console.log("계약서 해시값:",t),console.log("손글씨 해시값:",x),console.log("계약서 해시 서명:",m),console.log("손글씨 해시 서명:",S),(await fetch(`/api/contract/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileSignature:m,signImageSignature:S,contractHash:t,signImageHash:x,signer:u})})).ok?(p("서명 성공!"),console.log("서명 성공! uploaded → signed 상태 변경"),d.current?.clear(),f(""),h(""),r&&r()):p("서명 실패")};return(0,o.jsxs)("div",{style:{margin:"32px 0",padding:32,background:"#f8fafd",borderRadius:16,boxShadow:"0 2px 8px #0001",minWidth:480},children:[o.jsx("h3",{style:{marginBottom:20,fontSize:26},children:"✍️ 계약서 서명"}),o.jsx("input",{type:"text",placeholder:"서명자 이름",value:u,onChange:e=>f(e.target.value),style:{padding:"12px",width:"100%",marginBottom:"16px",fontSize:18}}),o.jsx(n.Z,{penColor:"black",canvasProps:{width:1e3,height:400,className:"sigCanvas"},ref:d,backgroundColor:"#f0f0f0",onEnd:()=>{let e=d.current?.toDataURL();e&&h(e)}}),(0,o.jsxs)("div",{style:{marginTop:"16px",display:"flex",gap:"16px",justifyContent:"center"},children:[o.jsx("button",{onClick:()=>{d.current?.clear(),h("")},style:{padding:"12px 24px",backgroundColor:"#757575",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:18},children:"지우기"}),o.jsx("button",{onClick:g,style:{padding:"12px 24px",backgroundColor:"#8bc34a",color:"#fff",border:"none",borderRadius:"8px",cursor:s?"pointer":"not-allowed",fontSize:18},disabled:!s,children:"서명 제출"})]}),y&&o.jsx("p",{style:{marginTop:"16px",fontSize:18},children:y})]})}},185:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var o=r(10326),a=r(35047),n=r(17577),i=r(76865);function s(){let e=(0,a.usePathname)(),[t,r]=(0,n.useState)(!1);return(0,n.useRef)(e),t?o.jsx(i.Z,{}):null}r(55440)},76865:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var o=r(10326);r(17577),r(55440);let a=()=>o.jsx("div",{className:"spinner-overlay",children:o.jsx("div",{className:"spinner"})})},917:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var o=r(10326),a=r(17577),n=r(15686),i=r(44099);let s=({contractId:e,onSuccess:t})=>{let[r,s]=(0,a.useState)(""),[c,l]=(0,a.useState)(null),d=async()=>{if(!c||!c.trim()){s("QR 코드가 인식되지 않았습니다. 이미지를 다시 업로드해 주세요."),console.log("[QR 확인 실패] 스캔 데이터 없음");return}try{console.log("[QR 확인 요청] contractId:",e,"qrCode:",c.trim());let r=await i.Z.post("/api/Qr/verify-qr",{contractId:e,qrCode:c.trim()});console.log("[QR 확인 응답]",r.data),r.data.success?(s("인증 성공! 서명 단계로 이동합니다..."),t&&t(c)):(s(r.data.message||"QR 코드 인증 실패: 올바른 QR 코드가 아닙니다."),console.log("[QR 인증 실패]",r.data))}catch(e){s(e?.response?.data?.message||"QR 코드 인증 실패: 서버 오류"),console.log("[QR 인증 예외]",e)}};return(0,o.jsxs)("div",{style:{minWidth:320,maxWidth:400,margin:"0 auto",padding:32,background:"#fff",borderRadius:16,boxShadow:"0 2px 16px #e3e8f7",border:"1px solid #e3e8f7",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center"},children:[o.jsx("h2",{style:{fontSize:22,fontWeight:700,color:"#1a237e",marginBottom:18,textAlign:"center"},children:"QR 코드 업로드"}),o.jsx("div",{style:{marginBottom:18},children:o.jsx("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];t&&n.Z.scanImage(t,{returnDetailedScanResult:!0}).then(e=>{l(e.data),s("QR 코드가 인식되었습니다. 아래 확인 버튼을 눌러주세요."),console.log("[QR 인식 성공]",e.data)}).catch(e=>{s("QR 이미지 인식 실패"),console.log("[QR 인식 실패]",e)})}})}),(0,o.jsxs)("div",{style:{fontSize:14,color:"#1a237e",marginBottom:24,fontWeight:500},children:["QR 이미지 파일을 업로드하세요.",o.jsx("br",{}),o.jsx("span",{style:{color:"#3b5cff",fontWeight:600},children:"(화면 캡처/저장 후 업로드 가능)"})]}),r&&o.jsx("p",{style:{margin:"24px 0 0 0",fontSize:16,color:"#3b5cff",fontWeight:600},children:r}),c&&o.jsx("button",{className:"clickable",style:{marginTop:20,padding:"12px 32px",fontSize:17,background:"#1a237e",color:"#fff",border:"none",borderRadius:6,fontWeight:600,boxShadow:"0 1px 4px #e3e8f7"},onClick:d,children:"확인"})]})}},65572:(e,t,r)=>{"use strict";r.d(t,{ContractProvider:()=>i,z:()=>s});var o=r(10326),a=r(17577);let n=(0,a.createContext)(void 0);function i({children:e}){let[t,r]=(0,a.useState)([]),[i,s]=(0,a.useState)(!0),c=(0,a.useCallback)(async()=>{s(!0);try{let e=await fetch("/api/contract",{credentials:"include"});if(!e.ok)throw Error("API error");let t=await e.json();r(t||[])}catch{r([])}finally{s(!1)}},[]);return o.jsx(n.Provider,{value:{contracts:t,loading:i,refreshContracts:c},children:e})}function s(){let e=(0,a.useContext)(n);if(!e)throw Error("useContractContext must be used within a ContractProvider");return e}},32779:(e,t,r)=>{"use strict";r.d(t,{NotificationProvider:()=>i,n:()=>s});var o=r(10326),a=r(17577);let n=(0,a.createContext)(void 0);function i({children:e}){let[t,r]=(0,a.useState)([]),[i,s]=(0,a.useState)(0),[c,l]=(0,a.useState)(!0),d=(0,a.useCallback)(async()=>{l(!0);try{let e=await fetch("/api/auth/notifications",{credentials:"include"});if(!e.ok)throw Error("API error");let t=await e.json();r(t.notifications||[]),s((t.notifications||[]).filter(e=>!e.read).length)}catch{r([]),s(0)}finally{l(!1)}},[]);return o.jsx(n.Provider,{value:{notifications:t,unreadCount:i,loading:c,refreshNotifications:d},children:e})}function s(){let e=(0,a.useContext)(n);if(!e)throw Error("useNotificationContext must be used within a NotificationProvider");return e}},9536:(e,t,r)=>{"use strict";r.d(t,{UserProvider:()=>i});var o=r(10326),a=r(17577);let n=(0,a.createContext)(void 0);function i({children:e}){let[t,r]=(0,a.useState)(null),i=async()=>{try{let e=await fetch("/api/user/me");if(!e.ok)throw Error("API error");let t=await e.json();r(t)}catch{r(null)}};return o.jsx(n.Provider,{value:{user:t,setUser:r,refreshUser:i},children:e})}},43192:(e,t,r)=>{"use strict";let o;async function a(e,t){let r=new TextEncoder,o=await window.crypto.subtle.importKey("raw",r.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:r.encode(t),iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function n(e,t){if(!window.crypto?.subtle)throw Error("이 브라우저는 WebCrypto를 지원하지 않습니다.");let r=new TextEncoder,o=window.crypto.getRandomValues(new Uint8Array(12)),a=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},t,r.encode(e));return{iv:btoa(String.fromCharCode(...o)),data:btoa(String.fromCharCode(...new Uint8Array(a)))}}async function i(e,t){if(!window.crypto?.subtle)throw Error("이 브라우저는 WebCrypto를 지원하지 않습니다.");let r=new TextDecoder,o=Uint8Array.from(atob(e.iv),e=>e.charCodeAt(0)),a=Uint8Array.from(atob(e.data),e=>e.charCodeAt(0)),n=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o},t,a);return r.decode(n)}function s(e){if(!o)throw Error("Node.js crypto not available");let t=Buffer.from(process.env.EMAIL_AES_KEY,"hex"),[r,a]=e.split(":"),n=Buffer.from(r,"hex"),i=o.createDecipheriv("aes-256-cbc",t,n);return i.update(a,"hex","utf8")+i.final("utf8")}async function c(){return a("5012145a3c04312f81ce8b38c90d875f7de96b868f94f451cd6d6709a92d7c23","38f74cb399659a9016a080d65395986f")}async function l(e){let t=await c(),{iv:r,data:o}=await n(e,t);return JSON.stringify({iv:r,data:o})}async function d(e){try{console.log("[decryptLocal] 입력값:",e);let t=await c(),r=JSON.parse(e);console.log("[decryptLocal] 파싱된 iv:",r.iv),console.log("[decryptLocal] 파싱된 data:",r.data);let o=await i({iv:r.iv,data:r.data},t);return console.log("[decryptLocal] 복호화 결과:",o),o}catch(e){throw console.error("[decryptLocal] 복호화 중 에러:",e),e}}r.d(t,{LJ:()=>s,bd:()=>a,hH:()=>l,jz:()=>i,oj:()=>n,vm:()=>d}),o=r(84770)},16041:(e,t,r)=>{"use strict";r.r(t),r.d(t,{STORE_NAME:()=>n,deleteAESKey:()=>x,deletePrivateKey:()=>d,exportPrivateKey:()=>u,getDB:()=>s,importPrivateKey:()=>f,loadAESKey:()=>p,loadPrivateKey:()=>l,saveAESKey:()=>y,savePrivateKey:()=>c});var o=r(84679),a=r(43192);let n="privateKeys",i="aesKeys";async function s(){return(0,o.X3)("secure-sign-db",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n),e.objectStoreNames.contains(i)||e.createObjectStore(i)}})}async function c(e,t,r){console.log("[DEBUG] savePrivateKey - 저장 전 privateKey (앞 50):",t.slice(0,50)),console.log("[DEBUG] savePrivateKey - 저장 전 privateKey 길이:",t.length);let o=await (0,a.bd)(r,e),i=await (0,a.oj)(t,o);console.log("[DEBUG] savePrivateKey - 암호화된 privateKey:",JSON.stringify(i).slice(0,100));let c=await s();await c.put(n,i,e)}async function l(e,t){let r=await s(),o=await r.get(n,e);if(!o)return;let i=await (0,a.bd)(t,e),c=await (0,a.jz)(o,i);return console.log("[DEBUG] loadPrivateKey - 복호화된 privateKey (앞 50):",c.slice(0,50)),console.log("[DEBUG] loadPrivateKey - 복호화된 privateKey 길이:",c.length),c}async function d(e){let t=await s();await t.delete(n,e)}async function u(e){let t=await s(),r=await t.get(n,e);if(r)return JSON.stringify({userId:e,encryptedPrivateKey:r})}async function f(e){try{let{userId:t,encryptedPrivateKey:r}=JSON.parse(e);if(!t||!r)throw Error("Invalid backup file");let o=await s();return await o.put(n,r,t),!0}catch{return!1}}async function y(e,t,r,o){let a=await s();await a.put(i,{encryptedAESKey:r,iv:o},`${e}:${t}`)}async function p(e,t){return(await s()).get(i,`${e}:${t}`)}async function x(e,t){let r=await s();await r.delete(i,`${e}:${t}`)}},91415:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var o=r(19510);function a({children:e}){return o.jsx(o.Fragment,{children:e})}},48395:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u,dynamic:()=>l,metadata:()=>d});var o=r(19510);r(67272);var a=r(68570);let n=(0,a.createProxy)(String.raw`E:\test2\contexts\NotificationContext.tsx#NotificationProvider`);(0,a.createProxy)(String.raw`E:\test2\contexts\NotificationContext.tsx#useNotificationContext`);let i=(0,a.createProxy)(String.raw`E:\test2\contexts\ContractContext.tsx#ContractProvider`);(0,a.createProxy)(String.raw`E:\test2\contexts\ContractContext.tsx#useContractContext`);let s=(0,a.createProxy)(String.raw`E:\test2\components\GlobalLoading.tsx#default`),c=(0,a.createProxy)(String.raw`E:\test2\contexts\UserContext.tsx#UserProvider`);(0,a.createProxy)(String.raw`E:\test2\contexts\UserContext.tsx#useUserContext`);let l="force-dynamic",d={title:"SignChain",description:"전자서명/계약 서비스"};function u({children:e}){return o.jsx("html",{lang:"en",children:o.jsx("body",{className:"antialiased",children:o.jsx(c,{children:o.jsx(n,{children:(0,o.jsxs)(i,{children:[o.jsx(s,{}),e]})})})})})}},67272:()=>{},55440:()=>{}};